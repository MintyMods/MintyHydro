<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Minty Hydro Controller</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="/static/assets/dhtmlx/suite/suite.min.js"></script><script src="/static/assets/dhtmlx/scheduler/dhtmlxscheduler.js"></script><link rel="stylesheet" href="/static/assets/dhtmlx/suite/suite.min.css"><link rel="stylesheet" href="/static/assets/dhtmlx/skins/material/dhtmlx.css"><link rel="stylesheet" href="/static/assets/dhtmlx/scheduler/dhtmlxscheduler.css"><link rel="stylesheet" href="/static/assets/dhtmlx/scheduler/dhtmlxscheduler_material.css"><link rel="stylesheet" href="/static/assets/fontawesome-pro/css/all.min.css"><link href="/styles.css" rel="stylesheet"></head><body><div id="layout_container"></div><script>var navSelected = 'environment';    
    var sidebarNavItems = [
        { id:'environment', type:'button', active:('environment'==navSelected), group:'nav', twoState:true, icon:'fal fa-cannabis', value:'Environment' },
        { id:'schedule', type:'button', active:('schedule'==navSelected), group:'nav', twoState:true, icon:'fal fa-calendar-alt', value:'Schedule' },
        { id:'controls', type:'button', active:('controls'==navSelected), group:'nav', twoState:true, icon:'fal fa-hand-holding-seedling', value:'Controls' },
        { id:'pumps', type:'button', active:('pumps'==navSelected), group:'nav', twoState:true, icon:'fal fa-faucet-drip', value:'Pumps' },
        { id:'sensors', type:'button', active:('sensors'==navSelected), group:'nav', twoState:true, icon:'fal fa-sensor', value:'Sensors' },
        { id:'settings', type:'button', active:('settings'==navSelected), group:'nav', twoState:true, icon:'fal fa-sliders-h-square', value:'Settings' },
        { id:'stats', type:'button', active:('stats'==navSelected), group:'nav', twoState:true, icon:'fal fa-analytics', value:'Statistics' },
    ];
    var layout = new dhx.Layout("layout_container", {
        height:'100vh',
        width:'100vw',
        padding: 0,
    	rows: [
			{ id: "toolbar_container", gravity:false, padding: 0 },
            { cols: [ 
                { id: "sidebar_container", gravity:true, css: "dhx_layout-cell--border_right" }, 
                { id: "content_container", gravity:true, width:'100%', height:'100%' } 
            ]}
        ]
    });
    
    var envLayout = new dhx.Layout(null, {
        height:'100%',
        width:'100%',
    	rows: [
            { id: "water_ph_container", gravity:true, padding: 0 },
            { id: "water_ec_container", gravity:true, padding: 0 },
            { id: "water_temp_container", gravity:true, padding: 0 },
            { id: "air_temp_container", gravity:true, padding: 0 },
            { id: "air_humidity_container", gravity:true, padding: 0 },
            { id: "control_container", gravity:true, padding: 0 },
            { cols: [ 
                { id: "extract_fan_container", gravity:true, css: "dhx_layout-cell--border_right" }, 
                { id: "intake_fan_container", gravity:true, width:'100%', height:'100%' } 
            ]}
        ]
    });


var html = "<p>Hello world</p>";
envLayout.cell("water_ec_container").attachHTML(html);

    var phChart = new dhx.Chart("chart", {
                type: "line",
                scales: {
                    "bottom" : {
                        text: "P.H."
                    },
                    "left" : {
                        maxTicks: 10,
                        max: 100,
                        min: 0
                    }
                },
                series: [
                    {
                        id: "ph",
                        value: "ph",
                        color: "#5E83BA",                       
                        fill: "#5E83BA"                     
                    }
                ]
            });

    var dataset = [
    { "month": "`02", "ph": 5.0},
    { "month": "`03", "ph": 6.0},
    { "month": "`04", "ph": 5.1},
    { "month": "`05", "ph": 5.2},
    { "month": "`06", "ph": 5.3},
    { "month": "`07", "ph": 5.5},
    { "month": "`08", "ph": 5.4},
    { "month": "`09", "ph": 5.3}
    ];
    phChart.data.parse(dataset);            
    envLayout.cell("water_ph_container").attach(phChart);

    // Toolbar Configuration 
	var toolbar = new dhx.Toolbar("toolbar_container", {
        css: "dhx_widget--border_bottom dhx_widget--bg_white",
		data: [
			{
				type: "button",
				color: "secondary",
				view: "link",
				circle: true,
				id: "toggle-sidebar",
				icon: "far fa-bars",
			},
			{
				type: "title",
				value: "Minty Hydro"
			},
            { type: "spacer" },
            {
				type: "button",
				color: "secondary",
				view: "link",
				circle: true,
				id: "notifications",
				icon: "fal fa-bell-on",
                count:2,
                countColor:'primary'
            }
		]
	});
	toolbar.events.on("click", function(id) {
        if (id === "toggle-sidebar") {
            sidebar.toggle();
		} else if (id === "toggle-sidebar") {
            showNotifications();
        }
	});
	layout.cell("toolbar_container").attach(toolbar);

    // Scheduler Configuration
    scheduler.config.header = [ "day","week","month","date","prev","today","next" ];
    scheduler.config.multi_day = true;
    scheduler.config.year_x = 2; //2 months in a row
    scheduler.config.year_y = 3; //3 months in a column    
    scheduler.locale.labels.year_tab ="Year";
    scheduler.attachEvent("onSchedulerReady", function () {
        requestAnimationFrame(function(){
            scheduler.setCurrentView(new Date(), "month");
            //scheduler.load("../common/events.json");
        });
    });

    const getPumpIcon = function(item) {
        if (item.active) {
            return '<i class="fal fa-cog fa-spin pump-running"></i>';
        } else if (item.state == 'auto') {
            return '<i class="fal fa-faucet-drip pump-stopped"></i>';
        } else {
            return '<i class="fal fa-faucet pump-stopped dhx_form-group--disabled"></i>';
        }
    }

    const pumpTemplate = function(item) {
        var item = '<div class="' + (item.active ? 'pump-running' : 'pump-stopped') + (item.state == 'off' ? ' dhx_form-group--disabled' : '') + '">' +
            getPumpIcon(item) + '<span class="title">  ' + item.value + '</span></div>';
        return item;
    }
    var pumpsList = new dhx.List(null, {
        template: pumpTemplate,
        itemHeight: 52,
        height: "100%",
        dragMode: "both"
    });
    var pumpData = [ /* State=off|on|auto */
        { value:"Recirculating", id:"RES", active:true, state:'auto' },
        { value:"Fill", id:"FILL", active:false, state:'auto' },
        { value:"Drain", id:"DRAIN", active:false, state:'auto' },
        { value:"Drip Feed", id:"DRIP", active:false, state:'on' },
        { value:"P.H. Up Dosing", id:"PHUP", active:true, state:'auto', speed:127},
        { value:"P.H. Down Dosing", id:"PHDOWN", active:false, state:'auto', speed:127},
        { value:"Cal Mag Dosing", id:"CALMAG", active:false, state:'auto', speed:127},
        { value:"HydroGuard Dosing", id:"HYDROGUARD", active:false, state:'auto', speed:127},
        { value:"Flora Micro Dosing", id:"MICRO", active:false, state:'auto', speed:127},
        { value:"Flora Grow Dosing", id:"GROW", active:false, state:'auto', speed:127},
        { value:"Flora Bloom Dosing", id:"BLOOM", active:false, state:'auto', speed:127},
        { value:"Spare - Currently not used", id:"SPARE", state:'off'}
    ]
    pumpsList.data.parse(pumpData);
    pumpsList.data.map(function (item, i) {
        if (item.active) {
            pumpsList.data.update(item.id, { css: "pump-running" });
        } else {
            pumpsList.data.update(item.id, { css: "pump-stopped" });
        }
    });

    // Side Bar Navigation
    var sidebar = new dhx.Sidebar("sidebar_container", { width:160, collapsed:true });
    // sidebar.data.parse(sidebarNavItems);
    debugger
    sidebar.data.load('/static/assets/json/navigation.json');
    sidebar.events.on("click", function(id){
        console.log("Sidebar clikced " + id);
        if (id === "schedule") {
            layout.cell("content_container").attach(scheduler);
		} else if (id === "environment") {
            layout.cell("content_container").attach(envLayout);
		} else if (id === "pumps") {
            layout.cell("content_container").attach(pumpsList);
        } else if (id === "controls") {
            var html = "<p>Hello world</p>";
            layout.cell("content_container").attachHTML(html);
        } else {
            var html = "<p>Failed</p>";
            layout.cell("content_container").attachHTML(html);   
        }       

    });
    layout.cell("sidebar_container").attach(sidebar);

 
    function showNotifications() {
        console.log("SHow notifications");
    }</script><script src="/bundle.ea1be58a28296e4a9123.js"></script><script src="/vendor.e31330bb46f372560e62.js"></script></body></html>