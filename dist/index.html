<!doctype html><html lang="en"><head><meta charset="utf-8"><title>Minty Hydro Controller</title><meta name="viewport" content="width=device-width,initial-scale=1"><script src="/assets/dhtmlx/suite/suite.min.js"></script><script src="/assets/dhtmlx/scheduler/dhtmlxscheduler.js"></script><script src="/assets/dhtmlx/scheduler/ext/dhtmlxscheduler_timeline.js"></script><script src="/assets/dhtmlx/scheduler/ext/dhtmlxscheduler_treetimeline.js"></script><script src="/scripts/minty_utility_functions.js"></script><link rel="stylesheet" href="/assets/dhtmlx/suite/suite.min.css"><link rel="stylesheet" href="/assets/dhtmlx/skins/material/dhtmlx.css"><link rel="stylesheet" href="/assets/dhtmlx/scheduler/dhtmlxscheduler.css"><link rel="stylesheet" href="/assets/dhtmlx/scheduler/dhtmlxscheduler_material.css"><link rel="stylesheet" href="/assets/fontawesome-pro/css/all.min.css"><link href="/styles.css" rel="stylesheet"></head><body><div id="layout_container"></div><script>var navSelected = 'controls';    

    var layout= new dhx.Layout("layout_container", {
        "height":"100vh",
        "width":"100vw",
        "padding":0,
        "rows":[
        {
            "id":"toolbar_container",
            "gravity":false,
            "padding":0
        },
        {
            "cols":[
                {
                    "id":"sidebar_container",
                    "gravity":true,
                    "css":"dhx_layout-cell--border_right"
                },
                {
                    "id":"content_container",
                    "gravity":true,
                    "width":"100%",
                    "height":"100%"
                }
            ]
        }
        ]
    });
        
    var envLayout = new dhx.Layout(null, {
        height:'100%',
        width:'100%',
    	rows: [
            { id: "water_ph_container", gravity:true, padding: 0 },
            { id: "water_ec_container", gravity:true, padding: 0, html:"<div>@todo Current pH & chart showing history will go here!</div>" },
            { id: "water_temp_container", gravity:true, padding: 0, html:"<div>@todo Current EC & chart showing history will go here!</div>" },
            { id: "air_temp_container", gravity:true, padding: 0, html:"<div>@todo Current TEMP & chart showing history will go here!</div>" },
            { id: "air_humidity_container", gravity:true, padding: 0, html:"<div>@todo Current Humidity & chart showing history will go here!</div>" },
            { id: "control_container", gravity:true, padding: 0, html:"<div>@todo Show Running Status of all Controls Here as Icons</div>" },
            { cols: [ 
                { id: "extract_fan_container", gravity:true, css: "dhx_layout-cell--border_right" }, 
                { id: "intake_fan_container", gravity:true, width:'100%', height:'100%' } 
            ]}
        ]
    });

    // Toolbar Configuration 
	var toolbar = new dhx.Toolbar("toolbar_container", {
        css: "dhx_widget--border_bottom dhx_widget--bg_white",
    });
    toolbar.data.load('/static/json/toolbar.json');
	toolbar.events.on("click", function(id) {
        if (id === "toggle-sidebar") {
            sidebar.toggle();
		} else if (id === "toggle-sidebar") {
            showNotifications();
        }
	});
	layout.cell("toolbar_container").attach(toolbar);

    // Scheduler Configuration
    scheduler.config.header = [ "day","week","month","timeline","date","prev","today","next" ];
    scheduler.config.multi_day = true;
    var automation = [
    { key: 1, label: 'Grow Light' },
    { key: 2, label: 'Extract Fan' },
    { key: 3, label: 'Intake Fan' },
    { key: 4, label: 'Oscillating Fan'},
    { key: 5, label: 'Water Heater'},
    { key: 6, label: 'Air Heater'},
    { key: 7, label: 'Humidifier'},
    { key: 8, label: 'De-Humidifier'},
    { key: 9, label: 'Air Pump'},
    { key: 10, label: 'Recirculating Pump'},
    { key: 11, label: '-- Res Change'},
    { key: 12, label: '-- Nutrient Dose'}
];

scheduler.locale.labels.timeline_tab ="Timeline";
scheduler.createTimelineView({
     name:"timeline",
     x_unit:"minute", // measuring unit of the X-Axis.
     x_date:"%H:%i",  // date format of the X-Axis
     x_step:30,       // X-Axis step in 'x_unit's
     x_size:24,       // X-Axis length specified as the total number of 'x_step's
     x_start:16,      // X-Axis offset in 'x_unit's
     x_length:48,     // number of 'x_step's that will be scrolled at a time
     y_unit: automation,
     y_property:"section_id", // mapped data property
     render:"days"             // view mode
});

    scheduler.config.lightbox.sections=[
        { type: "select", id: "automation", name: "Control", options: automation },        
        {name:"time", height:72, type:"time", map_to:"auto"}
    ];    
    scheduler.attachEvent("onSchedulerReady", function () {
        requestAnimationFrame(function(){
            scheduler.setCurrentView(new Date(), "month");
            //scheduler.load('/static/json/scheduler.json');
        });
    });

    var pumpsForm;
    loadJSON('/static/json/pumps.json', function(response) {
        pumpsForm = new dhx.Form(null, JSON.parse(response));
    });

    var controlsForm;
    loadJSON('/static/json/controls.json', function(response) {
        controlsForm = new dhx.Form(null, JSON.parse(response));
    });
    
    var sensorsForm;
    loadJSON('/static/json/sensors.json', function(response) {
        sensorsForm = new dhx.Form(null, JSON.parse(response));
    });

    var configForm;
    loadJSON('/static/json/config.json', function(response) {
        configForm = new dhx.Form(null, JSON.parse(response));
    });

    var dosingGrid = new dhx.Grid(null, {
        columns: [
            { id: "0", width:120, type:'string', header: [{ text: "Stage:" }], footer: [{ text: "Total:" }] },
            { id: "1", width:120, type:'number', header: [{ text:"Seedling" }], footer: [{ content: "sum" }] },
            { id: "2", width:120, type:'number', header: [{ text: "Early Growth" }], footer: [{ content: "sum" }] },
            { id: "3", width:120, type:'number', header: [{ text: "Late Growth" }], footer: [{ content: "sum" }] },
            { id: "4", width:120, type:'number', header: [{ text: "Transition" }], footer: [{ content: "sum" }] },
            { id: "5", width:120, type:'number', header: [{ text: "Early Bloom" }], footer: [{ content: "sum" }] },
            { id: "6", width:120, type:'number', header: [{ text: "Mid Bloom" }], footer: [{ content: "sum" }] },
            { id: "7", width:120, type:'number', header: [{ text: "Late Bloom" }], footer: [{ content: "sum" }] },
            { id: "8", width:120, type:'number', header: [{ text: "Ripen" }], footer: [{ content: "sum" }] },
            { id: "9", width:120, type:'number', header: [{ text: "Flush" }], footer: [{ content: "sum" }] }
        ],
        autoWidth:false,
        editable:true,
        sortable:true,
        resizable: true,
        splitAt:1, 
    });
    dosingGrid.data.load('/static/json/dosing.json');

    // Side Bar Navigation
    var sidebar = new dhx.Sidebar("sidebar_container", { width:160, collapsed:true });
    sidebar.data.load('/static/json/sidebar.json');
    sidebar.events.on("click", function(id){
        console.log("Sidebar clikced " + id);
        if (id === "schedule") {
            layout.cell("content_container").attach(scheduler);
		} else if (id === "environment") {
            layout.cell("content_container").attach(envLayout);
		} else if (id === "pumps") {
            layout.cell("content_container").attach(pumpsForm);
        } else if (id === "controls") {
            layout.cell("content_container").attach(controlsForm);
        } else if (id === "sensors") {
            layout.cell("content_container").attach(sensorsForm);
        } else if (id === "dosing") {
            layout.cell("content_container").attach(dosingGrid);
        } else if (id === "settings") {
            layout.cell("content_container").attach(configForm);
        } else {
        }       
    });
    layout.cell("sidebar_container").attach(sidebar);</script><script src="/bundle.ea1be58a28296e4a9123.js"></script><script src="/vendor.e31330bb46f372560e62.js"></script></body></html>